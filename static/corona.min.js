!function e(t,a,n){function r(s,o){if(!a[s]){if(!t[s]){var i="function"==typeof require&&require;if(!o&&i)return i(s,!0);if(d)return d(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=a[s]={exports:{}};t[s][0].call(l.exports,(function(e){return r(t[s][1][e]||e)}),l,l.exports,e,t,a,n)}return a[s].exports}for(var d="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,a){!function(e){"use strict";const t={country:"Germany",predict:7},a={};let n=null,r=null,d=[],s={country:null,predict:null},o={},i=new Date(1970);const c=e=>{const[,t,a,n,...r]=e.match(/^(\d{4})-(\d{2})-(\d{2})(\s(\d{2}):(\d{2}):(\d{2}))?/),d=new Date(t,a-1,n,0,0,0,0),[,s,o,i]=r;return s&&o&&i&&(d.setHours(s),d.setMinutes(o),d.setSeconds(i)),d},l=e=>{e&&(o=Object.assign({},e),o.dates=e.dates.map(e=>c(e))),i=c(o.latest.last_update),document.getElementById("latest-date").innerText=`${i.toLocaleDateString("de-DE")} ${i.toLocaleTimeString("de-DE")}`,document.getElementById("latest-total").innerText=o.latest.total.toLocaleString("de-DE"),document.getElementById("latest-active").innerText=o.latest.active.toLocaleString("de-DE"),document.getElementById("latest-deaths").innerText=o.latest.deaths.toLocaleString("de-DE"),document.getElementById("latest-recovered").innerText=o.latest.recovered.toLocaleString("de-DE"),document.getElementById("App").classList.remove("hidden"),a.loader_screen.classList.add("hide");const t=o.dates[o.dates.length-1];let d=[...o.dates];const l=new Date(t);for(let e=0;e<s.predict;++e)l.setDate(l.getDate()+e+1),d.push(l);const u=o.predicted?new Array(o.active.length).fill(null).concat(o.predicted.active.slice(0,s.predict)):[];d=d.map(e=>e.toLocaleDateString("de-DE")),a.current_date.innerText=d[o.dates.length-1],a.latest_date.innerText=s.predict>0&&o.predicted?d[o.dates.length-1+s.predict]:"–",a.current_cases.innerText=o.active?o.active[o.active.length-1].toLocaleString("de-DE"):"–",a.latest_cases.innerText=s.predict>0&&o.predicted?o.predicted.active[s.predict-1].toLocaleString("de-DE"):"–",r?(r.data.labels=d.slice(0,o.total.length),r.data.datasets[0].data=o.delta,r.update()):r=new Chart(document.getElementById("diff-chart").getContext("2d"),{type:"bar",data:{labels:d.slice(0,o.total.length),datasets:[{data:o.delta,backgroundColor:function(e,t){return t.dataset.data[t.dataIndex]<0?"#63D427":"#D42C27"}.bind(null,!1)}]},options:{title:{display:!0,text:"∆ active cases"},responsive:!0,maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{gridLines:{display:!1,drawTicks:!1},ticks:{display:!1}}],yAxes:[{gridLines:{display:!0,drawTicks:!1},ticks:{display:!1}}]},animation:{duration:250,easing:"easeInOutQuad"}}}),n?(n.data.labels=d,n.data.datasets[0].data=o.active,n.data.datasets[1].data=o.recovered,n.data.datasets[2].data=o.deaths,n.data.datasets[3].data=u,n.data.datasets[4].data=o.doubling_rates,n.update()):n=new Chart(document.getElementById("main-chart").getContext("2d"),{type:"bar",data:{labels:d,datasets:[{data:o.active,type:"bar",yAxisID:"A",label:"active",backgroundColor:"rgb(230, 88, 36)",borderWidth:0,fill:"transparent",order:2},{data:o.recovered,type:"bar",yAxisID:"A",label:"recovered",backgroundColor:"#7CDC58",borderWidth:0,fill:"transparent",order:2},{data:o.deaths,type:"bar",yAxisID:"A",label:"deaths",backgroundColor:"#D16EDC",borderWidth:0,fill:"transparent",order:3},{data:u,type:"bar",yAxisID:"A",label:"predicted total",backgroundColor:"#555",borderWidth:0,fill:"transparent"},{data:o.doubling_rates,type:"line",yAxisID:"B",label:"days per doubling",borderColor:"#5BA5E6",borderWidth:2,pointStyle:"circle",fill:"transparent",showLine:!1,order:0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{xAxes:[{stacked:!0,gridLines:{display:!1}}],yAxes:[{id:"A",type:"linear",position:"right",precision:1,stacked:!0,beginAtZero:!0},{id:"B",type:"linear",position:"left",precision:.1,stacked:!1,beginAtZero:!0,gridLines:{display:!1}}]},animation:{duration:500,easing:"easeInOutQuad"}}})},u=()=>{console.debug("evaluateHash()");let n={};for(const t of e.location.hash.substring(1).split(";")){const[e,a]=t.split("=");e&&a&&(n[e]=decodeURIComponent(a))}n=Object.assign({},t,n),console.debug("evaluateHash() data = ",n),console.debug("evaluateHash() hash_param = ",s);const r=Math.min(Math.max(0,+n.predict),+a.prediction_days.getAttribute("max"));d.indexOf(n.country)>=0&&(a.country_selector.value=n.country,n.country!==s.country&&(s.country=n.country,m())),r!==n.predict&&r!=s.predict&&(s.predict=r,a.prediction_days.value=r,o.active&&l()),g(n)},p=e=>{console.debug("hashChanged()",e),e&&e.oldURL!==e.newURL&&u()},g=(t={})=>{const a=Object.assign({},s,t);e.location.hash="#"+Object.keys(a).map(e=>`${e}=${a[e]}`).join(";")},m=()=>{console.debug("loadCountryData()"),a.loader_screen.classList.remove("hide"),b(),fetch(`data/${s.country}.json`).then(e=>e.ok?e.json():Promise.reject(e.status)).then(e=>{[...document.getElementsByClassName("country")].forEach(t=>t.innerText=e.country),a.prediction_days.setAttribute("max",e.predicted?e.predicted.active.length:0),a.flag.innerText=e.flag,a.population.innerText=e.population.toLocaleString("de-DE"),l(e),[...document.getElementsByClassName("refreshable")].forEach(e=>e.classList.add("flash")),setTimeout(()=>{[...document.getElementsByClassName("refreshable")].forEach(e=>e.classList.remove("flash"))},1e3)},e=>{E(`Fetching data for »${s.country}« failed: ${e}. Reload page to retry …`)})},y=e=>{o={},i=new Date(1970),g({country:e.target.value})},h=e=>{const t=Math.min(+e.target.value,+a.prediction_days.getAttribute("max"));g({predict:t})},E=e=>{a.error_message.innerText=e,a.error_message.classList.add("show")},b=e=>{a.error_message.innerText="",a.error_message.classList.remove("show")};e.addEventListener("load",()=>{a.country_selector=document.getElementById("country-selector"),a.flag=document.getElementById("flag"),a.loader_screen=document.getElementById("loader-screen"),a.current_date=document.getElementById("current-date"),a.current_cases=document.getElementById("current-cases"),a.latest_date=document.getElementById("predicted-date"),a.latest_cases=document.getElementById("predicted-cases"),a.prediction_days=document.getElementById("prediction-days"),a.population=document.getElementById("population"),a.error_message=document.getElementById("error-message"),(async()=>{b(),console.debug("fetchCountryList()");const e=await fetch("data/countries.json"),t=await(e.ok?e.json():Promise.reject(e.status));d=t;const a=document.getElementById("countries");d.sort().forEach((e,t)=>{const n=document.createElement("option");n.value=e,a.appendChild(n)})})().then(()=>{u(),a.country_selector.addEventListener("change",y),a.prediction_days.addEventListener("change",h),e.addEventListener("hashchange",p),document.getElementById("refresh-button").addEventListener("click",m),[...document.getElementsByClassName("stepper")].forEach(e=>{const t=e.querySelector("input");t.previousElementSibling.addEventListener("click",e=>{t.stepDown(),t.dispatchEvent(new Event("change"))}),t.nextElementSibling.addEventListener("click",e=>{t.stepUp(),t.dispatchEvent(new Event("change"))})})},e=>{E(`Loading country list failed: ${e}. Reload page to retry …`)})})}(window)},{}]},{},[1]);
